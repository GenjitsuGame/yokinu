{"version":3,"sources":["../../../src/core/routes/services.js"],"names":["express","require","router","Router","DelayedResponse","route","post","req","res","next","serviceName","params","service","module","app","locals","services","delayed","wait","status","json","error","load","then","end","message","catch","console","log","err","exports"],"mappings":"AAAA;;AAEA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,SAASF,QAAQG,MAAR,EAAf;AACA,IAAMC,kBAAkBH,QAAQ,uBAAR,CAAxB;;AAEAC,OACGG,KADH,CACS,gBADT,EAEGC,IAFH,CAEQ,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACxB,MAAMC,cAAcH,IAAII,MAAJ,CAAWC,OAA/B;AACA,MAAMC,SAASN,IAAIO,GAAJ,CAAQC,MAAR,CAAeC,QAAf,CAAwBN,WAAxB,CAAf;AACA,MAAMO,UAAU,IAAIb,eAAJ,CAAoBG,GAApB,EAAyBC,GAAzB,EAA8BC,IAA9B,CAAhB;AACAQ,UAAQC,IAAR;AACA,MAAI,CAACL,MAAL,EAAa,OAAOL,IAAIW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACvCC,WAAO,4BAA4BX,WAA5B,GAA0C;AADV,GAArB,CAAP;;AAIbG,SACGS,IADH,GAEGC,IAFH,CAEQ,YAAM;AACVN,YAAQO,GAAR,CAAY;AACVC,eAAS,aAAaf,WAAb,GAA2B;AAD1B,KAAZ;AAGD,GANH,EAOGgB,KAPH,CAOS,eAAO;AACZC,YAAQC,GAAR,CAAYC,GAAZ;AACApB,SAAKoB,GAAL;AACD,GAVH;AAWD,CAtBH;;AAwBAhB,OAAOiB,OAAP,GAAiB5B,MAAjB","file":"services.js","sourcesContent":["'use strict';\n\nconst express = require('express');\nconst router = express.Router();\nconst DelayedResponse = require('http-delayed-response');\n\nrouter\n  .route('/:service/load')\n  .post((req, res, next) => {\n    const serviceName = req.params.service;\n    const module = req.app.locals.services[serviceName];\n    const delayed = new DelayedResponse(req, res, next);\n    delayed.wait();\n    if (!module) return res.status(404).json({\n      error: 'No service found for : ' + serviceName + '.'\n    });\n\n    module\n      .load()\n      .then(() => {\n        delayed.end({\n          message: 'service ' + serviceName + ' loaded!'\n        });\n      })\n      .catch(err => {\n        console.log(err);\n        next(err);\n      });\n  });\n\nmodule.exports = router;\n"]}