{"version":3,"sources":["../../../src/core/routes/playlists.js"],"names":["express","require","router","Router","db","route","get","req","res","next","Track","find","playlists","$exists","$ne","tracks","reduce","prev","curr","forEach","playlistName","playlist","service","name","push","json","data","catch","module","exports"],"mappings":"AAAA;;;;;;;;;;;;AAEA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,SAASF,QAAQG,MAAR,EAAf;AACA,IAAMC,KAAKH,QAAQ,aAAR,CAAX;;AAEAC,OACGG,KADH,CACS,GADT,EAEGC,GAFH,CAEO,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACvB,6DAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACsBL,GAAGM,KAAH,CAASC,IAAT,CAAc;AACjCC,yBAAW;AACTC,yBAAS,IADA;AAETC,qBAAK;AAFI;AADsB,aAAd,CADtB;;AAAA;AACOC,kBADP;AAQOH,qBARP,GAQmBG,OAAOC,MAAP,CAAc,UAACC,IAAD,EAAOC,IAAP,EAAgB;AAC9CA,mBAAKN,SAAL,CAAeO,OAAf,CAAuB,oBAAY;AACjC,oBAAMC,eAAeC,SAASC,OAAT,GAAmB,GAAnB,GAAyBD,SAASE,IAAvD;AACA,oBAAI,CAACN,KAAKG,YAAL,CAAL,EAAyBH,KAAKG,YAAL,IAAqB,EAArB;AACzBH,qBAAKG,YAAL,EAAmBI,IAAnB,CAAwBN,IAAxB;AACD,eAJD;AAKA,qBAAOD,IAAP;AACD,aAPiB,EAOf,EAPe,CARnB;AAAA,6CAiBQT,IAAIiB,IAAJ,CAAS;AACdC,oBAAMd;AADQ,aAAT,CAjBR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,KAoBKe,KApBL,CAoBWlB,IApBX;AAqBD,CAxBH;;AA0BAmB,OAAOC,OAAP,GAAiB3B,MAAjB","file":"playlists.js","sourcesContent":["'use strict';\n\nconst express = require('express');\nconst router = express.Router();\nconst db = require('../database');\n\nrouter\n  .route('/')\n  .get((req, res, next) => {\n    (async () => {\n      const tracks = await db.Track.find({\n        playlists: {\n          $exists: true,\n          $ne: []\n        }\n      });\n\n      const playlists = tracks.reduce((prev, curr) => {\n        curr.playlists.forEach(playlist => {\n          const playlistName = playlist.service + ' ' + playlist.name;\n          if (!prev[playlistName]) prev[playlistName] = [];\n          prev[playlistName].push(curr);\n        });\n        return prev;\n      }, {});\n\n      return res.json({\n        data: playlists\n      });\n    })().catch(next);\n  });\n\nmodule.exports = router;\n"]}